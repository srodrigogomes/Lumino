<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LUMINO - Puzzle Diário</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap');
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #050505;
            color: white;
            touch-action: manipulation;
            overflow: hidden; /* Evita scroll elástico no mobile */
        }

        /* O Grid do Jogo */
        .game-board {
            display: grid;
            gap: 8px;
            margin: 0 auto;
            transition: all 0.3s ease;
        }

        .tile {
            aspect-ratio: 1;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            border: 1px solid #333;
        }

        /* Estado APAGADO (Escuro) */
        .tile.off {
            background-color: #1a1a1a;
        }

        /* Estado ACESO (Brilhante) */
        .tile.on {
            background-color: #0ea5e9; /* Sky 500 */
            box-shadow: 0 0 15px #0ea5e9, inset 0 0 10px rgba(255,255,255,0.3);
            border-color: #7dd3fc;
            transform: scale(0.98);
        }

        .tile:active {
            transform: scale(0.90);
        }

        /* Animação de entrada */
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* Botões de Fase */
        .level-btn {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            transition: transform 0.2s;
        }
        .level-btn:active { transform: scale(0.9); }
        
        .lvl-locked { background: #171717; color: #444; border: 1px solid #262626; cursor: not-allowed; }
        .lvl-future { background: #000; color: #333; border: 1px dashed #333; cursor: not-allowed; opacity: 0.5; }
        .lvl-current { background: #0ea5e9; color: white; box-shadow: 0 0 10px #0ea5e9; animation: pulse 2s infinite; }
        .lvl-done { background: #10b981; color: white; }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(14, 165, 233, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(14, 165, 233, 0); }
            100% { box-shadow: 0 0 0 0 rgba(14, 165, 233, 0); }
        }

        /* Scrollbar customizada */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: #111; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }

    </style>
</head>
<body class="h-screen w-full flex flex-col items-center justify-between p-4 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-slate-900 via-black to-black">

    <!-- HEADER -->
    <header class="w-full max-w-md flex justify-between items-end mb-4 pt-2">
        <div>
            <h1 class="text-3xl font-bold tracking-tighter text-white">LUMINO</h1>
            <p class="text-xs text-sky-400 font-medium tracking-widest uppercase">Acenda todas as luzes</p>
        </div>
        <div class="text-right">
            <div id="day-badge" class="bg-slate-800 px-3 py-1 rounded-full text-xs font-bold text-white border border-slate-700">
                Dia 1
            </div>
        </div>
    </header>

    <!-- ÁREA CENTRAL (Muda entre Menu e Jogo) -->
    <main id="app-container" class="flex-1 w-full max-w-md relative flex flex-col justify-center">
        
        <!-- TELA 1: SELEÇÃO DE FASES -->
        <div id="screen-menu" class="absolute inset-0 flex flex-col">
            <div class="flex-1 overflow-y-auto custom-scroll pr-2 pb-20">
                <div class="grid grid-cols-5 gap-3" id="levels-grid">
                    <!-- Gerado via JS -->
                </div>
            </div>
            
            <!-- Controle de Debug (Simulação de Dias) -->
            <div class="mt-4 p-3 bg-slate-900/50 rounded-xl border border-slate-800 backdrop-blur-sm">
                <div class="flex justify-between text-[10px] text-slate-400 mb-2 uppercase tracking-wide">
                    <span>Simular Passagem de Tempo</span>
                    <span id="debug-day-count" class="text-sky-400 font-bold">+0 Dias</span>
                </div>
                <input type="range" id="time-slider" min="0" max="60" value="0" 
                    class="w-full h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-sky-500">
            </div>
        </div>

        <!-- TELA 2: O JOGO -->
        <div id="screen-game" class="hidden absolute inset-0 flex flex-col items-center justify-center">
            
            <!-- Topo do Jogo -->
            <div class="w-full flex justify-between items-center mb-8 px-2">
                <button onclick="goToMenu()" class="p-2 rounded-full bg-slate-800 text-white hover:bg-slate-700 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </button>
                <div class="text-center">
                    <h2 id="level-title" class="text-xl font-bold text-white">Fase 1</h2>
                    <p class="text-[10px] text-slate-500 uppercase tracking-widest">Toque para inverter</p>
                </div>
                <button onclick="resetLevel()" class="p-2 rounded-full bg-slate-800 text-white hover:bg-slate-700 transition" title="Reiniciar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/></svg>
                </button>
            </div>

            <!-- O Tabuleiro -->
            <div id="board" class="game-board">
                <!-- Tiles gerados via JS -->
            </div>

            <p id="moves-counter" class="mt-8 text-sm text-slate-500 font-mono">Movimentos: 0</p>

        </div>

        <!-- OVERLAY DE VITÓRIA -->
        <div id="victory-overlay" class="hidden absolute inset-0 bg-black/90 backdrop-blur-sm z-50 flex flex-col items-center justify-center text-center p-6 animate-fade-in">
            <h2 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-emerald-400 mb-2">RESOLVIDO!</h2>
            <p class="text-slate-400 mb-8">O sistema foi sincronizado.</p>
            
            <button onclick="nextLevel()" class="w-full py-4 bg-white text-black font-bold text-lg rounded-xl hover:scale-105 transition shadow-[0_0_20px_rgba(255,255,255,0.3)]">
                Próximo Nível
            </button>
        </div>

    </main>

    <footer class="w-full text-center py-4">
        <p class="text-[10px] text-slate-600">Jogue uma nova fase a cada 24h.</p>
    </footer>

    <script>
        // CONFIGURAÇÕES
        const TOTAL_LEVELS = 60;
        const LAUNCH_DATE = new Date(); 
        LAUNCH_DATE.setHours(0,0,0,0);

        // ESTADO GLOBAL
        const state = {
            currentDay: 1,
            maxUnlockedLevel: 1, // Pelo tempo
            userProgress: 1,     // Pelo jogador
            playingLevel: 1,
            moves: 0,
            gridSize: 3,
            tiles: [], // Estado atual do board (true = on, false = off)
            simulatedDays: 0
        };

        // --- SISTEMA DE RANDOMIZAÇÃO DETERMINÍSTICA ---
        // Isso garante que a fase 5 seja a mesma para todos, sempre solúvel.
        // Ao invés de criar puzzles aleatórios, começamos com um puzzle RESOLVIDO
        // e clicamos aleatoriamente nele X vezes. O jogador só precisa reverter.
        class SeededRNG {
            constructor(seed) { this.seed = seed; }
            next() {
                this.seed = (this.seed * 9301 + 49297) % 233280;
                return this.seed / 233280;
            }
        }

        // --- INICIALIZAÇÃO ---
        function init() {
            // Carregar Save
            const saved = localStorage.getItem('lumino_save');
            if (saved) state.userProgress = parseInt(saved);

            // Setup Data
            updateTimeLogic();

            // Renderizar Menu
            renderMenu();

            // Listeners
            document.getElementById('time-slider').addEventListener('input', (e) => {
                state.simulatedDays = parseInt(e.target.value);
                document.getElementById('debug-day-count').innerText = `+${state.simulatedDays} Dias`;
                updateTimeLogic();
                renderMenu();
            });
        }

        function updateTimeLogic() {
            const now = new Date();
            now.setDate(now.getDate() + state.simulatedDays);
            
            const diffTime = Math.abs(now - LAUNCH_DATE);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            state.currentDay = diffDays;
            state.maxUnlockedLevel = Math.min(diffDays, TOTAL_LEVELS);
            
            document.getElementById('day-badge').innerText = `Dia ${state.currentDay}`;
        }

        // --- MENU ---
        function renderMenu() {
            const grid = document.getElementById('levels-grid');
            grid.innerHTML = '';

            for (let i = 1; i <= TOTAL_LEVELS; i++) {
                const btn = document.createElement('div');
                btn.className = 'level-btn';
                
                // Lógica de Estado
                if (i > state.maxUnlockedLevel) {
                    // Futuro
                    btn.classList.add('lvl-future');
                    btn.innerText = i;
                } else if (i > state.userProgress) {
                    // Trancado (precisa passar o anterior)
                    btn.classList.add('lvl-locked');
                    btn.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>`;
                } else if (i < state.userProgress) {
                    // Completo
                    btn.classList.add('lvl-done');
                    btn.innerText = i;
                    btn.onclick = () => startLevel(i);
                } else {
                    // Atual
                    btn.classList.add('lvl-current');
                    btn.innerText = i;
                    btn.onclick = () => startLevel(i);
                }
                grid.appendChild(btn);
            }
        }

        function goToMenu() {
            document.getElementById('screen-game').classList.add('hidden');
            document.getElementById('screen-menu').classList.remove('hidden');
            document.getElementById('victory-overlay').classList.add('hidden');
            renderMenu();
        }

        // --- GAME ENGINE ---
        function startLevel(level) {
            state.playingLevel = level;
            state.moves = 0;
            document.getElementById('screen-menu').classList.add('hidden');
            document.getElementById('screen-game').classList.remove('hidden');
            document.getElementById('level-title').innerText = `NÍVEL ${level}`;
            document.getElementById('moves-counter').innerText = "Movimentos: 0";

            // Configurar Dificuldade
            if (level <= 5) state.gridSize = 3;       // 3x3 Fácil
            else if (level <= 20) state.gridSize = 4; // 4x4 Médio
            else state.gridSize = 5;                  // 5x5 Difícil

            generateBoard(level);
        }

        function generateBoard(level) {
            const size = state.gridSize;
            const totalTiles = size * size;
            const rng = new SeededRNG(level * 777); // Seed única por nível

            // Começamos com um tabuleiro "VITORIOSO" (Todos acesos = true)
            // Ou todos apagados. Vamos definir que o objetivo é ACENDER TUDO.
            // Então começamos com tudo true.
            state.tiles = new Array(totalTiles).fill(true);

            // Agora "bagunçamos" o tabuleiro clicando aleatoriamente
            // Isso garante que SEMPRE é possível resolver (revertendo os cliques)
            const scrambleMoves = 5 + Math.floor(level * 1.5); // Mais difícil = mais bagunça

            for (let i = 0; i < scrambleMoves; i++) {
                const randomIdx = Math.floor(rng.next() * totalTiles);
                toggleLogic(randomIdx, true); // true = modo silencioso (sem som/anim)
            }

            renderBoard();
        }

        function renderBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            board.style.gridTemplateColumns = `repeat(${state.gridSize}, 1fr)`;
            
            // Largura máxima do board
            const w = Math.min(window.innerWidth - 40, 350);
            board.style.width = `${w}px`;

            state.tiles.forEach((isOn, idx) => {
                const tile = document.createElement('div');
                tile.className = `tile ${isOn ? 'on' : 'off'} animate-pop`;
                // Ajustar delay da animação para efeito cascata na entrada
                tile.style.animationDelay = `${idx * 0.02}s`; 
                
                tile.onclick = () => handleMove(idx);
                board.appendChild(tile);
            });
        }

        function updateBoardVisuals() {
            const tiles = document.querySelectorAll('.tile');
            state.tiles.forEach((isOn, idx) => {
                const tile = tiles[idx];
                if (isOn) {
                    tile.classList.remove('off');
                    tile.classList.add('on');
                } else {
                    tile.classList.remove('on');
                    tile.classList.add('off');
                }
            });
        }

        function handleMove(index) {
            // Vibração Tátil (Android)
            if (navigator.vibrate) navigator.vibrate(5);
            
            state.moves++;
            document.getElementById('moves-counter').innerText = `Movimentos: ${state.moves}`;
            
            toggleLogic(index);
            updateBoardVisuals();
            checkWin();
        }

        function toggleLogic(index, silent = false) {
            const size = state.gridSize;
            const x = index % size;
            const y = Math.floor(index / size);

            // Função auxiliar para inverter um tile
            const flip = (i) => {
                if (i >= 0 && i < state.tiles.length) {
                    state.tiles[i] = !state.tiles[i];
                }
            };

            // Inverte o clicado e vizinhos (Cruz)
            flip(index); // O próprio
            if (x > 0) flip(index - 1); // Esquerda
            if (x < size - 1) flip(index + 1); // Direita
            if (y > 0) flip(index - size); // Cima
            if (y < size - 1) flip(index + size); // Baixo
        }

        function checkWin() {
            // Vitória se TODOS estiverem ACESOS (true)
            const allOn = state.tiles.every(t => t === true);
            
            if (allOn) {
                // Efeito Confete
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#0ea5e9', '#ffffff', '#10b981']
                });

                setTimeout(() => {
                    document.getElementById('victory-overlay').classList.remove('hidden');
                    
                    // Salvar progresso
                    if (state.playingLevel === state.userProgress) {
                        state.userProgress++;
                        localStorage.setItem('lumino_save', state.userProgress);
                    }
                }, 500);
            }
        }

        function resetLevel() {
            generateBoard(state.playingLevel);
        }

        function nextLevel() {
            const next = state.playingLevel + 1;
            
            // Re-checa tempo caso tenha passado da meia noite
            updateTimeLogic();

            if (next <= TOTAL_LEVELS && next <= state.maxUnlockedLevel) {
                document.getElementById('victory-overlay').classList.add('hidden');
                startLevel(next);
            } else {
                alert("Você completou todos os desafios de hoje! Volte amanhã.");
                goToMenu();
            }
        }

        // Start
        init();

    </script>
</body>
</html>